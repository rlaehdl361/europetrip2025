<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <!-- ëª¨ë°”ì¼ì—ì„œ ì…ë ¥ ì‹œ ìë™ í™•ëŒ€ ë°©ì§€ ë° ë·°í¬íŠ¸ ì„¤ì • -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Doy & Donghui Europe Trip</title>
    
    <!-- ì•„ì´í° í™ˆ í™”ë©´ ì•„ì´ì½˜ ì„¤ì • -->
    <link rel="apple-touch-icon" href="icon.png?v=2">
    <link rel="icon" href="icon.png?v=2">
    
    <!-- ì•„ì´í° í™ˆ í™”ë©´ ì¶”ê°€ ì‹œ ì•±ì²˜ëŸ¼ ë³´ì´ê¸° -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Europe Trip">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM & Babel -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background-color: #000000; border-radius: 2px; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #FEF0E4;
            overflow-x: hidden;
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
        }
        /* í…ìŠ¤íŠ¸ í¬ê¸° ë³€ê²½ ì‹œ ë¶€ë“œëŸ¬ìš´ ì „í™˜ì„ ìœ„í•œ íŠ¸ëœì§€ì…˜ ìµœì í™” */
        .header-text {
            will-change: font-size, line-height;
            transition: font-size 0.3s ease-out, line-height 0.3s ease-out;
        }
    </style>
</head>
<body class="bg-[#FEF0E4]">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, doc, onSnapshot, setDoc, getDoc, collection } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        // ==========================================================================================
        // [ì¤‘ìš”] ì‚¬ìš©ìê°€ ì œê³µí•œ Firebase ì„¤ì •
        // ==========================================================================================
        const USER_FIREBASE_CONFIG = {
            apiKey: "AIzaSyAx6XwgUqIHdE4Q20Ks96BcL4WEAwVozy0",
            authDomain: "europetrip2025-605da.firebaseapp.com",
            projectId: "europetrip2025-605da",
            storageBucket: "europetrip2025-605da.firebasestorage.app",
            messagingSenderId: "650619202562",
            appId: "1:650619202562:web:0d1d4aa64bc63885944b1b",
            measurementId: "G-W592MB05JK"
        };
        // ==========================================================================================

        let db = null;
        let dataDocRef = null;
        let isFirebaseActive = false;

        async function initDB() {
            let config;
            if (typeof __firebase_config !== 'undefined') {
                config = JSON.parse(__firebase_config);
                isFirebaseActive = true;
            } else if (USER_FIREBASE_CONFIG.apiKey) {
                config = USER_FIREBASE_CONFIG;
                isFirebaseActive = true;
            } else {
                console.warn("Firebase ì„¤ì •ì´ ì—†ìŠµë‹ˆë‹¤. ë¡œì»¬ ì €ì¥ì†Œë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.");
                isFirebaseActive = false;
                return null;
            }

            try {
                const app = initializeApp(config);
                const auth = getAuth(app);
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }
                db = getFirestore(app);
                if (typeof __firebase_config !== 'undefined') {
                     const appId = typeof __app_id !== 'undefined' ? __app_id : 'default';
                     const colRef = collection(db, 'artifacts', appId, 'public', 'data', 'trip_data');
                     dataDocRef = doc(colRef, 'shared'); 
                } else {
                     dataDocRef = doc(db, 'trips', 'shared_europe_trip');
                }
                return dataDocRef;
            } catch (e) {
                console.error("Firebase Init Error:", e);
                isFirebaseActive = false;
                return null;
            }
        }

        const { useState, useEffect, useRef } = React;
        
        // --- Icons ---
        const MinimalIcon = ({ type }) => {
            const strokeWidth = 2; 
            const SvgWrapper = ({ children }) => (
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth={strokeWidth} strokeLinecap="round" strokeLinejoin="round" className="w-6 h-6 shrink-0">
                    <circle cx="12" cy="12" r="9" />
                    {children}
                </svg>
            );
            const iconMap = {
                Plane: <path d="M7 17L17 7M7 7h10v10" />, 
                Train: <path d="M7 17L17 7M7 7h10v10" />,
                Home: <rect x="8" y="8" width="8" height="8" rx="0.5" />,
                Utensils: <path d="M12 7v10M7 12h10" />,
                ShoppingBag: <circle cx="12" cy="12" r="3.5" />,
                Coffee: <path d="M8 10v2a4 4 0 0 0 4 4 4 4 0 0 0 4-4v-2" />,
                Camera: <g><rect x="7" y="9" width="10" height="7" rx="1" /><path d="M10 9V7h4v2" /></g>,
                Info: <g><rect x="7" y="9" width="10" height="7" rx="1" /><path d="M10 9V7h4v2" /></g>,
                MapPin: <circle cx="12" cy="12" r="3" />,
            };
            return <SvgWrapper>{iconMap[type] || iconMap.MapPin}</SvgWrapper>;
        };

        const ThinTrash = ({ size = 16 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>
            </svg>
        );

        const MinimalChefHat = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M6 13.87A4 4 0 0 1 7.41 6a5.11 5.11 0 0 1 1.05-1.54 5 5 0 0 1 7.08 0A5.11 5.11 0 0 1 16.59 6 4 4 0 0 1 18 13.87V21H6Z" />
                <line x1="6" y1="17" x2="18" y2="17" />
            </svg>
        );

        const LockIcon = ({size=20}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>;
        const XIcon = ({size=24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>;
        const MapPinIcon = ({size=16}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>;
        const AlertTriangleIcon = ({size=20}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>;
        const PlusIcon = ({size=20}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>;
        const CheckSquareIcon = ({size=16}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="9 11 12 14 22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg>;

        // --- Initial Data ---
        const initialSchedule = [
            { day: 1, date: "12.13 (í† )", city: "Paris", title: "íŒŒë¦¬ ë„ì°©", events: [{ id: 101, time: "18:30", iconType: "Plane", type: "ì´ë™", desc: "íŒŒë¦¬ ìƒ¤ë¥¼ë“œê³¨ ê³µí•­ ë„ì°©" }, { id: 102, time: "20:00", iconType: "Home", type: "ìˆ™ì†Œ", desc: "Castex Hotel ì²´í¬ì¸ (ë§ˆë ˆì§€êµ¬)" }, { id: 103, time: "20:30", iconType: "Utensils", type: "ì‹ì‚¬", desc: "Le Temps des Cerises (ì €ë…)" }] },
            { day: 2, date: "12.14 (ì¼)", city: "Paris", title: "ë¹ˆí‹°ì§€ì™€ ì¼ìš”ì¼", events: [{ id: 201, time: "10:00", iconType: "ShoppingBag", type: "ì‡¼í•‘", desc: "ë°©ë¸Œ ë²¼ë£©ì‹œì¥" }, { id: 202, time: "12:30", iconType: "Utensils", type: "ì‹ì‚¬", desc: "La CrÃªperie de Josselin (ì ì‹¬)" }, { id: 203, time: "13:00", iconType: "Coffee", type: "íœ´ì‹", desc: "ë¤½ìƒë¶€ë¥´ ê³µì› ì‚°ì±…" }, { id: 204, time: "14:00", iconType: "ShoppingBag", type: "ì‡¼í•‘", desc: "ë¥´ ë´‰ ë§ˆë¥´ì…° ë°±í™”ì " }, { id: 205, time: "16:00", iconType: "Camera", type: "ê´€ê´‘", desc: "ë§ˆë¥´ìŠ¤ ê´‘ì¥ (ì—í íƒ‘)" }, { id: 206, time: "18:00", iconType: "Home", type: "ìˆ™ì†Œ", desc: "ì—ì–´ë¹„ì•¤ë¹„(Rue des Tournelles) ì²´í¬ì¸" }] },
            { day: 3, date: "12.15 (ì›”)", city: "Paris", title: "ì˜ˆìˆ ê³¼ ê±´ì¶•", events: [{ id: 301, time: "10:00", iconType: "ShoppingBag", type: "ì‡¼í•‘", desc: "ìƒíˆ¬ì•™ ë²¼ë£©ì‹œì¥" }, { id: 302, time: "13:00", iconType: "Utensils", type: "ì‹ì‚¬", desc: "Ma Cocotte (ì ì‹¬)" }, { id: 303, time: "15:00", iconType: "Camera", type: "ê´€ê´‘", desc: "ì˜¤ë‘ì£¼ë¦¬ ë¯¸ìˆ ê´€" }, { id: 304, time: "17:00", iconType: "Camera", type: "ê´€ê´‘", desc: "í”¼ë…¸ ì»¬ë ‰ì…˜ (Bourse de Commerce)" }] },
            { day: 4, date: "12.16 (í™”)", city: "Paris", title: "ë§ˆë ˆì§€êµ¬ ì‚°ì±…", events: [{ id: 401, time: "10:30", iconType: "Coffee", type: "ì¹´í˜", desc: "Boot CafÃ©" }, { id: 402, time: "12:15", iconType: "Utensils", type: "ì‹ì‚¬", desc: "Septime (ì˜ˆì•½ë¨)" }, { id: 403, time: "14:30", iconType: "Info", type: "ê´€ê´‘", desc: "ì¹´ë¥´ë‚˜ë°œë ˆ ë°•ë¬¼ê´€" }, { id: 404, time: "16:00", iconType: "ShoppingBag", type: "ì‡¼í•‘", desc: "ë©”ë¥´ì‹œ(Merci) í¸ì§‘ìƒµ" }] },
            { day: 5, date: "12.17 (ìˆ˜)", city: "Paris", title: "í´ë˜ì‹ íŒŒë¦¬", events: [{ id: 501, time: "09:00", iconType: "Camera", type: "ê´€ê´‘", desc: "ì˜¤ë¥´ì„¸ ë¯¸ìˆ ê´€" }, { id: 502, time: "13:00", iconType: "Utensils", type: "ì‹ì‚¬", desc: "Les Deux Magots (ì¹´í˜)" }, { id: 503, time: "14:30", iconType: "ShoppingBag", type: "ì‡¼í•‘", desc: "Astier de Villatte (ê·¸ë¦‡)" }, { id: 504, time: "16:30", iconType: "Coffee", type: "ê°„ì‹", desc: "PoilÃ¢ne (ì‚¬ê³¼ íƒ€ë¥´íŠ¸)" }, { id: 505, time: "18:00", iconType: "Camera", type: "ê´€ê´‘", desc: "íë‡Œí”„ / ì„¼ëŠê°• ì‚°ì±…" }] },
            { day: 6, date: "12.18 (ëª©)", city: "Paris", title: "ê±´ì¶• íˆ¬ì–´", events: [{ id: 601, time: "10:30", iconType: "Camera", type: "ê´€ê´‘", desc: "ë¹Œë¼ ë¼ ë¡œìŠˆ (ë¥´ ì½”ë¥´ë·”ì§€ì—)" }, { id: 602, time: "13:00", iconType: "Utensils", type: "ì‹ì‚¬", desc: "CafÃ© KitsunÃ© (íŒ”ë ˆ ë£¨ì•„ì–„)" }, { id: 603, time: "15:00", iconType: "Info", type: "ê´€ê´‘", desc: "ê°¤ëŸ¬ë¦¬ ë¹„ë¹„ì—” (ì•„ì¼€ì´ë“œ)" }] },
            { day: 7, date: "12.19 (ê¸ˆ)", city: "Prague", title: "í”„ë¼í•˜ ì´ë™", events: [{ id: 701, time: "16:50", iconType: "Plane", type: "ì´ë™", desc: "íŒŒë¦¬ ì¶œë°œ (CDG)" }, { id: 702, time: "18:30", iconType: "Plane", type: "ì´ë™", desc: "í”„ë¼í•˜ ë„ì°© (PRG)" }, { id: 703, time: "20:00", iconType: "Home", type: "ìˆ™ì†Œ", desc: "ì•Œí°ìŠ¤ ë¶€í‹°í¬ í˜¸í…” ì²´í¬ì¸" }, { id: 704, time: "21:00", iconType: "Camera", type: "ê´€ê´‘", desc: "êµ¬ì‹œê°€ì§€ ê´‘ì¥ í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ë§ˆì¼“" }] },
            { day: 8, date: "12.20 (í† )", city: "Prague", title: "ë³´í—¤ë¯¸ì•ˆ ê°ì„±", events: [{ id: 801, time: "10:00", iconType: "Info", type: "íˆ¬ì–´", desc: "í™”ì•½íƒ‘ (íŒíˆ¬ì–´ ë§Œë‚¨)" }, { id: 802, time: "13:00", iconType: "Utensils", type: "ì‹ì‚¬", desc: "NaÅ¡e Maso (ì •ìœ¡ì  ì‹ë‹¹)" }, { id: 803, time: "15:00", iconType: "Coffee", type: "ì¹´í˜", desc: "Grand Cafe Orient (íë¹„ì¦˜)" }, { id: 804, time: "17:00", iconType: "Camera", type: "ê´€ê´‘", desc: "ê¹Œë êµ ì‚°ì±…" }, { id: 805, time: "19:30", iconType: "Utensils", type: "ì‹ì‚¬", desc: "LokÃ¡l DlouhÃ¡Ã¡Ã¡ (ë§¥ì£¼)" }] },
            { day: 9, date: "12.21 (ì¼)", city: "Dresden", title: "í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ë§ˆì¼“", events: [{ id: 901, time: "12:30", iconType: "Train", type: "ì´ë™", desc: "í”„ë¼í•˜ ì¤‘ì•™ì—­ ì¶œë°œ" }, { id: 902, time: "14:30", iconType: "Train", type: "ì´ë™", desc: "ë“œë ˆìŠ¤ë´ ì¤‘ì•™ì—­ ë„ì°©" }, { id: 903, time: "15:00", iconType: "Home", type: "ìˆ™ì†Œ", desc: "Star G Hotel Premium" }, { id: 904, time: "16:00", iconType: "Info", type: "ê´€ê´‘", desc: "ì¸ ë¹™ê±° ê¶ì „" }, { id: 905, time: "17:30", iconType: "Camera", type: "ê´€ê´‘", desc: "ìŠˆíŠ¸ë¦¬ì²¼ë§ˆë¥´í¬íŠ¸ (ë§ˆì¼“)" }] },
            { day: 10, date: "12.22 (ì›”)", city: "Berlin", title: "ë² ë¥¼ë¦° í™ìŠ¤í„°", events: [{ id: 1001, time: "12:25", iconType: "Train", type: "ì´ë™", desc: "ë“œë ˆìŠ¤ë´ ì¶œë°œ" }, { id: 1002, time: "14:45", iconType: "Home", type: "ìˆ™ì†Œ", desc: "Casa Camper Berlin" }, { id: 1003, time: "16:00", iconType: "Coffee", type: "ì¹´í˜", desc: "ë³´ë‚œì ì»¤í”¼ íˆì–´ë¡œì¦ˆ" }, { id: 1004, time: "18:00", iconType: "ShoppingBag", type: "ì‡¼í•‘", desc: "ë¯¸í…Œ(Mitte) ì§€êµ¬ í¸ì§‘ìƒµ" }, { id: 1005, time: "19:30", iconType: "Utensils", type: "ì‹ì‚¬", desc: "Monsieur Vuong (ìŒ€êµ­ìˆ˜)" }] },
            { day: 11, date: "12.23 (í™”)", city: "Berlin", title: "í˜„ëŒ€ ë¯¸ìˆ ", events: [{ id: 1101, time: "10:30", iconType: "Camera", type: "ê´€ê´‘", desc: "ì‹  êµ­ë¦½ ë¯¸ìˆ ê´€ (ë¯¸ìŠ¤ ë°˜ ë°ì–´ ë¡œì—)" }, { id: 1102, time: "13:30", iconType: "Utensils", type: "ì‹ì‚¬", desc: "ì»¤ë¦¬ë¶€ì–´ìŠ¤íŠ¸" }, { id: 1103, time: "15:00", iconType: "ShoppingBag", type: "ì‡¼í•‘", desc: "Voo Store / Do You Read Me?!" }, { id: 1104, time: "17:30", iconType: "Camera", type: "ì²´í—˜", desc: "í¬í† ì˜¤í† ë§ˆíŠ¸ (í‘ë°±ì‚¬ì§„)" }, { id: 1105, time: "19:00", iconType: "ShoppingBag", type: "ì‡¼í•‘", desc: "REWE ë§ˆíŠ¸ ì¥ë³´ê¸° (ì´ë¸Œ ëŒ€ë¹„)" }] },
            { day: 12, date: "12.24 (ìˆ˜)", city: "Berlin", title: "ê³ ìš”í•œ ì´ë¸Œ", events: [{ id: 1201, time: "10:00", iconType: "Camera", type: "ê´€ê´‘", desc: "ë…ì¼ êµ­íšŒì˜ì‚¬ë‹¹ ë”" }, { id: 1202, time: "13:00", iconType: "Camera", type: "ê´€ê´‘", desc: "ë¸Œë€ë´ë¶€ë¥´í¬ ë¬¸" }, { id: 1203, time: "15:00", iconType: "Home", type: "íœ´ì‹", desc: "í˜¸í…” íœ´ì‹ & íŒŒí‹°" }] },
            { day: 13, date: "12.25 (ëª©)", city: "Berlin", title: "ë©”ë¦¬ ë² ë¥¼ë¦°", events: [{ id: 1301, time: "13:00", iconType: "Camera", type: "ê´€ê´‘", desc: "ë°•ë¬¼ê´€ ì„¬" }, { id: 1302, time: "16:00", iconType: "Utensils", type: "ì‹ì‚¬", desc: "ì  ë‹¤ë¥´ë©˜ ë§ˆì¼“" }, { id: 1303, time: "19:00", iconType: "Utensils", type: "ì‹ì‚¬", desc: "Paris Moskau (ë””ë„ˆ)" }] },
            { day: 14, date: "12.26 (ê¸ˆ)", city: "Frankfurt", title: "ë§ˆì§€ë§‰ ì—¬ì •", events: [{ id: 1401, time: "11:57", iconType: "Train", type: "ì´ë™", desc: "ë² ë¥¼ë¦° ì¤‘ì•™ì—­ ì¶œë°œ" }, { id: 1402, time: "16:00", iconType: "Plane", type: "ì´ë™", desc: "í”„ë‘í¬í‘¸ë¥´íŠ¸ ê³µí•­ ì´ë™" }] },
            { day: 15, date: "12.27 (í† )", city: "Seoul", title: "ê·€êµ­", events: [{ id: 1501, time: "14:00", iconType: "Home", type: "ë„ì°©", desc: "ì¸ì²œê³µí•­ ë„ì°© ğŸ " }] },
        ];

        const initialRecommendations = {
            places: [
                { id: 'p1', city: "PARIS", items: [{ id: 'p1-1', name: "Ofr. Paris", desc: "ë§ˆë ˆì§€êµ¬ ì˜ˆìˆ  ì„œì , ì—ì½”ë°± í•„ìˆ˜" }, { id: 'p1-2', name: "Boot CafÃ©", desc: "êµ¬ë‘ ìˆ˜ì„ ì§‘ì„ ê°œì¡°í•œ ì•„ì£¼ ì‘ì€ ì¹´í˜" }, { id: 'p1-3', name: "Maison La Roche", desc: "ë¥´ ì½”ë¥´ë·”ì§€ì— ê±´ì¶•ì˜ ì •ìˆ˜" }, { id: 'p1-4', name: "Bourse de Commerce", desc: "ì•ˆë„ íƒ€ë‹¤ì˜¤ì˜ ì½˜í¬ë¦¬íŠ¸ ë¯¸í•™" }] },
                { id: 'p2', city: "PRAGUE", items: [{ id: 'p2-1', name: "Grand Cafe Orient", desc: "ì„¸ê³„ ìœ ì¼ íë¹„ì¦˜(ì…ì²´íŒŒ) ì¹´í˜" }, { id: 'p2-2', name: "Jazz Dock", desc: "ê°• ìœ„ì—ì„œ ì¦ê¸°ëŠ” í˜„ëŒ€ì ì¸ ì¬ì¦ˆ ê³µì—°" }] },
                { id: 'p3', city: "DRESDEN", items: [{ id: 'p3-1', name: "Kunsthofpassage", desc: "ë¹„ê°€ ì˜¤ë©´ ë…¸ë˜í•˜ëŠ” ë°°ìˆ˜ê´€ì´ ìˆëŠ” ì˜ˆìˆ  ì§€êµ¬" }, { id: 'p3-2', name: "Pfunds Molkerei", desc: "ì„¸ê³„ì—ì„œ ê°€ì¥ ì•„ë¦„ë‹¤ìš´ ìœ ì œí’ˆ ê°€ê²Œ" }] },
                { id: 'p4', city: "BERLIN", items: [{ id: 'p4-1', name: "Voo Store", desc: "í¬ë¡œì´ì¸ ë² ë¥´í¬ì˜ í™í•œ ì»¨ì…‰ ìŠ¤í† ì–´" }, { id: 'p4-2', name: "Do You Read Me?!", desc: "ê·¸ë˜í”½ ë””ìì¸, íŒ¨ì…˜ ì¡ì§€ ì „ë¬¸ ì„œì " }, { id: 'p4-3', name: "Neue Nationalgalerie", desc: "ë¯¸ìŠ¤ ë°˜ ë°ì–´ ë¡œì—ì˜ ëª¨ë”ë‹ˆì¦˜ ê±¸ì‘" }] }
            ],
            shopping: [
                { id: 's1', city: "PARIS", items: [{ id: 's1-1', name: "Astier de Villatte", desc: "ê·¸ë¦‡ (ê¸°ë‚´ ë°˜ì… í•„ìˆ˜!) - ì—„ë§ˆ ì„ ë¬¼" }, { id: 's1-2', name: "E.Dehillerin", desc: "ìš”ë¦¬ ë•í›„ë“¤ì˜ ì„±ì§€, ì „ë¬¸ ì£¼ë°©ìš©í’ˆ" }, { id: 's1-3', name: "Merci", desc: "íŒ”ì°Œ ë° ê°ê°ì ì¸ ì¸í…Œë¦¬ì–´ ì†Œí’ˆ" }, { id: 's1-4', name: "CityPharma", desc: "ëª½ì¥¬ë³´ë‹¤ ì €ë ´í•œ ì•½êµ­ í™”ì¥í’ˆ (ë¦½ë°¤)" }, { id: 's1-5', name: "Sabre Paris", desc: "ë¹„ìŠ¤íŠ¸ë¡œ ìŠ¤íƒ€ì¼ ì»¤íŠ¸ëŸ¬ë¦¬ ì„¸íŠ¸" }] },
                { id: 's2', city: "PRAGUE", items: [{ id: 's2-1', name: "Manufaktura", desc: "ë§¥ì£¼ ìƒ´í‘¸, ì™€ì¸ ë°”ë””ì›Œì‹œ (ì„ ë¬¼ìš©)" }, { id: 's2-2', name: "Blue Praha", desc: "ì²´ì½” ì „í†µ ìª½ë¹› ìœ ë¦¬ ê³µì˜ˆí’ˆ" }, { id: 's2-3', name: "Pragtique", desc: "ê°ê°ì ì¸ ë””ìì¸ ì—½ì„œ, ì—ì½”ë°±" }, { id: 's2-4', name: "Wooden Toys", desc: "í•˜ë²¨ ì‹œì¥ì˜ ê·€ì—¬ìš´ ëª©ê° ì¸í˜•" }] },
                { id: 's3', city: "BERLIN", items: [{ id: 's3-1', name: "Bauhaus Archive Shop", desc: "ë°”ìš°í•˜ìš°ìŠ¤ í¬ìŠ¤í„° ë° ë””ìì¸ ë¬¸êµ¬" }, { id: 's3-2', name: "Voo Store", desc: "Acne Studios ë“± í™í•œ ë¸Œëœë“œ ì˜ë¥˜" }, { id: 's3-3', name: "Ampelmann", desc: "ê·€ì—¬ìš´ ë² ë¥¼ë¦° ì‹ í˜¸ë“± ìºë¦­í„° êµ¿ì¦ˆ" }, { id: 's3-4', name: "Do You Read Me?!", desc: "ì¸í…Œë¦¬ì–´ìš©ìœ¼ë¡œ ì¢‹ì€ ì•„íŠ¸ ë§¤ê±°ì§„" }, { id: 's3-5', name: "DM", desc: "ì•„ìš”ë‚˜ ì¹˜ì•½, ë°œí¬ë¹„íƒ€ë¯¼ (ê°€ì„±ë¹„ ìµœê³ )" }] },
                { id: 's4', city: "DRESDEN", items: [{ id: 's4-1', name: "Meissen", desc: "ì„¸ê³„ì ì¸ ëª…í’ˆ ë§ˆì´ì„¼ ë„ìê¸°" }, { id: 's4-2', name: "Camondas", desc: "ë“œë ˆìŠ¤ë´ì˜ ìœ ëª… ì´ˆì½œë¦¿ & ì½”ì½”ì•„" }, { id: 's4-3', name: "KÃ¤the Wohlfahrt", desc: "í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ì˜¤ë„ˆë¨¼íŠ¸ (1ë…„ ë‚´ë‚´ ì˜¤í”ˆ)" }] }
            ],
            cooking: [
                { id: 'c1', title: "1. ì†Œê³ ê¸° ìŠ¤í…Œì´í¬", desc: "ì •ìœ¡ì ì—ì„œ ì•ˆì‹¬(Filet)ì´ë‚˜ ë“±ì‹¬ì„ ë‘ê»ê²Œ ì°ì–´ë‹¬ë¼ê³  í•˜ì„¸ìš”.", items: ["ì†Œê³ ê¸°", "ë²„í„°(Echire)", "íŠ¸ëŸ¬í”Œ ì†Œê¸ˆ", "ì•„ìŠ¤íŒŒë¼ê±°ìŠ¤"] },
                { id: 'c2', title: "2. ë‚©ì‘ë³µìˆ­ì•„ & ë¶€ë¼íƒ€ ìƒëŸ¬ë“œ", desc: "ê°„ë‹¨í•˜ì§€ë§Œ ê°€ì¥ ìœ ëŸ½ìŠ¤ëŸ¬ìš´ ë§›.", items: ["ë‚©ì‘ë³µìˆ­ì•„(ë˜ëŠ” ë©”ë¡ )", "ë¶€ë¼íƒ€ ì¹˜ì¦ˆ", "ë£¨ê¼´ë¼", "ì˜¬ë¦¬ë¸Œì˜¤ì¼", "í›„ì¶”"] },
                { id: 'c3', title: "3. íŠ¸ëŸ¬í”Œ íŒŒìŠ¤íƒ€", desc: "ë§ˆíŠ¸ì—ì„œ ìƒë©´ íŒŒìŠ¤íƒ€ì™€ íŠ¸ëŸ¬í”Œ ì†ŒìŠ¤ë¥¼ ì‚¬ë©´ ë.", items: ["ìƒë©´ íŒŒìŠ¤íƒ€", "íŠ¸ëŸ¬í”Œ í˜ìŠ¤í† ", "íŒŒë§ˆì‚° ì¹˜ì¦ˆ", "ì–‘ì†¡ì´ ë²„ì„¯"] },
                { id: 'c4', title: "4. ì ë´‰ ëµˆë¥´ ìƒŒë“œìœ„ì¹˜", desc: "ì•„ì¹¨ ì‹ì‚¬ë¡œ ìµœê³ .", items: ["ë°”ê²ŒíŠ¸ íŠ¸ë¼ë””ì‹œì˜¹", "ê°€ì—¼ ë²„í„°", "ì ë´‰(ì–‡ì€ í–„)"] },
                { id: 'c5', title: "5. ì™€ì¸ ì•ˆì£¼ ì¹˜ì¦ˆ í”Œë˜í„°", desc: "ì €ë…ì— ë„·í”Œë¦­ìŠ¤ ë³´ë©´ì„œ.", items: ["ì½©í…Œ(Comte) ì¹˜ì¦ˆ", "ë¸Œë¦¬ ì¹˜ì¦ˆ", "ì²­í¬ë„", "í¬ë˜ì»¤"] },
                { id: 'c6', title: "6. í™í•©íƒ• (Moules MariniÃ¨res)", desc: "í™”ì´íŠ¸ ì™€ì¸ë§Œ ìˆìœ¼ë©´ ëšë”±.", items: ["ì†ì§ˆëœ í™í•©", "í™”ì´íŠ¸ ì™€ì¸", "ë§ˆëŠ˜", "ì–‘íŒŒ", "ë²„í„°"] },
                { id: 'c7', title: "7. í›ˆì œ ì—°ì–´ & ì•„ë³´ì¹´ë„", desc: "ê±´ê°•í•œ ì•„ì¹¨.", items: ["í›ˆì œ ì—°ì–´", "ì•„ë³´ì¹´ë„", "ë ˆëª¬", "í˜¸ë°€ë¹µ"] },
                { id: 'c8', title: "8. ìš”ê±°íŠ¸ ë³¼", desc: "ìœ ëŸ½ ìš”ê±°íŠ¸ëŠ” ì •ë§ ì§„í•´ìš”.", items: ["ê·¸ë¦­ ìš”ê±°íŠ¸", "ë³¸ë§ˆë§ ì¼", "ê·¸ë˜ë†€ë¼", "ë² ë¦¬ë¥˜"] },
                { id: 'c9', title: "9. ì†Œì‹œì§€ êµ¬ì´ & ê°ì", desc: "ë…ì¼ ë§ˆíŠ¸ í„¸ê¸°.", items: ["ë¶€ì–´ìŠ¤íŠ¸(ì†Œì‹œì§€)", "ê°ì(ì‚¶ê±°ë‚˜ êµ½ê¸°)", "ì‚¬ìš°ì–´í¬ë¼ìš°íŠ¸(ë³‘ì¡°ë¦¼)"] },
                { id: 'c10', title: "10. ë‚©ì‘ë³µìˆ­ì•„ & ìš”ê±°íŠ¸", desc: "ë””ì €íŠ¸ë¡œ ìµœê³ .", items: ["ë‚©ì‘ë³µìˆ­ì•„", "ê¿€", "ìš”ê±°íŠ¸"] }
            ]
        };

        const initialChecklist = [
            { id: 'c1', text: "ì—¬í–‰ì ë³´í—˜ ê°€ì… í™•ì¸", checked: false },
            { id: 'c2', text: "ì½ì„ ì±…, ë…¸íŠ¸ë¶ ì±™ê¸°ê¸°", checked: false },
            { id: 'c3', text: "ë‹¤ì´ì†Œ ìƒ¤ì›Œë³¼ êµ¬ë§¤", checked: false },
            { id: 'c4', text: "ëƒ‰ì¥ê³  ì •ë¦¬ (ìœ í†µê¸°í•œ ì„ë°• ìŒì‹)", checked: false },
            { id: 'c5', text: "ë©´ì„¸ì  ì‡¼í•‘ ë¦¬ìŠ¤íŠ¸ ìµœì¢… í™•ì¸", checked: false },
            { id: 'c6', text: "ë¨¸ë¦¬ ì—¼ìƒ‰ / ë„¤ì¼ ë°›ê¸°", checked: false },
            { id: 'c7', text: "ì²´ì½”í–‰ ë¹„í–‰ê¸° ì˜¨ë¼ì¸ ì²´í¬ì¸ (í•„ìˆ˜!)", checked: false, important: true },
            { id: 'c8', text: "ìˆ˜í™”ë¬¼ ê·œì • ë° ìºë¦¬ì–´ í¬ê¸° í™•ì¸", checked: false },
            { id: 'c9', text: "ì•Œí°ìŠ¤ ë¶€í‹°í¬ í˜¸í…” íˆ¬ìˆ™ê° ì •ë³´ ì…ë ¥", checked: false },
            { id: 'c10', text: "ì—ì–´ë¹„ì•¤ë¹„ ì²´í¬ì¸ ê°€ì´ë“œ í™•ì¸", checked: false },
            { id: 'c11', text: "ê³ ì–‘ì´(ë‘ì´) íƒë¬˜ ë§¡ê¸°ê¸°", checked: true },
            { id: 'c12', text: "ê²½ëŸ‰íŒ¨ë”© ì¤€ë¹„", checked: true },
            { id: 'c13', text: "ë¶™ì´ëŠ” í•«íŒ© ë„‰ë„‰íˆ ì±™ê¸°ê¸°", checked: true },
            { id: 'c14', text: "ì¹˜ì•ˆ ìš©í’ˆ (ìë¬¼ì‡ , ì˜·í•€) ì±™ê¸°ê¸°", checked: true },
            { id: 'c15', text: "íœ´ëŒ€í° ì‚¼ê°ëŒ€ ë° ì´¬ì˜ ìš©í’ˆ", checked: true },
            { id: 'c16', text: "ì—¬í–‰ ì˜· ì‡¼í•‘ (Shein ë°°ì†¡ í™•ì¸)", checked: true },
            { id: 'c17', text: "ì£¼ìš” ë°•ë¬¼ê´€/ë¯¸ìˆ ê´€ ì˜ˆì•½ í™•ì¸", checked: true },
            { id: 'c18', text: "ì „ê¸°ì¥íŒ ì±™ê¸°ê¸° (ìœ ëŸ½ ë‚œë°© ì•½í•¨)", checked: true }
        ];

        const initialNotices = [
            { id: 'n1', text: "ì²´ì½”í–‰ ë¹„í–‰ê¸° ì˜¨ë¼ì¸ ì²´í¬ì¸ í•„ìˆ˜ (ê³µí•­ ìœ ë£Œ)" },
            { id: 'n2', text: "ë…ì¼ 12/24~26 ìƒì  íœ´ë¬´ (ë¯¸ë¦¬ ì¥ë³´ê¸°)" },
            { id: 'n3', text: "ë² ë¥¼ë¦° êµí†µê¶Œì€ ABì¡´ ì¼ì¼ê¶Œ ì¶”ì²œ" }
        ];

        const App = () => {
            const [activeTab, setActiveTab] = useState('itinerary');
            const [recommendSubTab, setRecommendSubTab] = useState('places'); 
            const [selectedDay, setSelectedDay] = useState(1);
            const [mapViewMode, setMapViewMode] = useState('real'); 
            const [selectedLocation, setSelectedLocation] = useState(null);
            const [isEditMode, setIsEditMode] = useState(false);
            const [isScrolled, setIsScrolled] = useState(false);
            
            const [showPasswordModal, setShowPasswordModal] = useState(false);
            const [passwordInput, setPasswordInput] = useState("");
            const [passwordError, setPasswordError] = useState(false);
            
            // 2. ì¬ë£Œ ìˆ˜ì •ìš© ì„ì‹œ ì €ì¥ì†Œ (í¸ì§‘ ì¤‘ì¸ í…ìŠ¤íŠ¸ ë³´ê´€)
            const [tempCookingItems, setTempCookingItems] = useState({});

            const headerRef = useRef(null);
            const contentRef = useRef(null);

            const [newEvent, setNewEvent] = useState({ time: "", type: "ê´€ê´‘", desc: "" });
            const [newRec, setNewRec] = useState({ name: "", desc: "" });
            const [newCooking, setNewCooking] = useState({ title: "", desc: "", ingredients: "" });
            const [newItemText, setNewItemText] = useState("");
            const [newNoticeText, setNewNoticeText] = useState("");
            
            const [editingChecklistId, setEditingChecklistId] = useState(null);
            const [tempChecklistText, setTempChecklistText] = useState("");
            const [editingNoticeId, setEditingNoticeId] = useState(null);
            const [tempNoticeText, setTempNoticeText] = useState("");

            const [data, setData] = useState({
                schedule: initialSchedule,
                recommendations: initialRecommendations,
                checklistItems: initialChecklist,
                notices: initialNotices
            });

            useEffect(() => {
                let unsubscribe;
                const startSync = async () => {
                    const docRef = await initDB();
                    if (isFirebaseActive && docRef) {
                        unsubscribe = onSnapshot(docRef, (docSnap) => {
                            if (docSnap.exists()) {
                                setData(docSnap.data());
                            } else {
                                setDoc(docRef, data);
                            }
                        }, (error) => {
                            console.error("Sync Error:", error);
                        });
                    } else {
                        const savedData = localStorage.getItem('tripData');
                        if (savedData) {
                            setData(JSON.parse(savedData));
                        }
                    }
                };
                startSync();
                return () => { if (unsubscribe) unsubscribe(); };
            }, []);

            const updateData = (newData) => {
                setData(newData);
                if (isFirebaseActive && dataDocRef) {
                    setDoc(dataDocRef, newData, { merge: true });
                } else {
                    localStorage.setItem('tripData', JSON.stringify(newData));
                }
            };

            const toggleCheck = (id) => {
                if (isEditMode) return;
                const newItems = data.checklistItems.map(item => item.id === id ? { ...item, checked: !item.checked } : item);
                updateData({ ...data, checklistItems: newItems });
            };

            const addChecklistItem = () => {
                if (!newItemText.trim()) return;
                const newItem = { id: Date.now().toString(), text: newItemText, checked: false };
                updateData({ ...data, checklistItems: [newItem, ...data.checklistItems] });
                setNewItemText("");
            };

            const deleteChecklistItem = (e, id) => {
                e.stopPropagation();
                const newItems = data.checklistItems.filter(item => item.id !== id);
                updateData({ ...data, checklistItems: newItems });
            };

            const startEditingChecklist = (id, text) => {
                if (isEditMode) {
                    setEditingChecklistId(id);
                    setTempChecklistText(text);
                }
            };

            const saveEditingChecklist = (id) => {
                const newItems = data.checklistItems.map(item => item.id === id ? { ...item, text: tempChecklistText } : item);
                updateData({ ...data, checklistItems: newItems });
                setEditingChecklistId(null);
                setTempChecklistText("");
            };

            const addNotice = () => {
                if (!newNoticeText.trim()) return;
                const newItems = [...data.notices, { id: Date.now().toString(), text: newNoticeText }];
                updateData({ ...data, notices: newItems });
                setNewNoticeText("");
            };

            const deleteNotice = (id) => {
                const newItems = data.notices.filter(n => n.id !== id);
                updateData({ ...data, notices: newItems });
            };

            const startEditingNotice = (id, text) => {
                if (isEditMode) {
                    setEditingNoticeId(id);
                    setTempNoticeText(text);
                }
            };

            const saveEditingNotice = (id) => {
                const newItems = data.notices.map(n => n.id === id ? { ...n, text: tempNoticeText } : n);
                updateData({ ...data, notices: newItems });
                setEditingNoticeId(null);
                setTempNoticeText("");
            };

            const addEvent = (dayIndex) => {
                if (!newEvent.time || !newEvent.desc) { alert("ì‹œê°„ê³¼ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”."); return; }
                const newSchedule = [...data.schedule];
                const dayEvents = [...newSchedule[dayIndex].events];
                dayEvents.push({ id: Date.now(), time: newEvent.time, type: newEvent.type, desc: newEvent.desc, iconType: "MapPin" });
                dayEvents.sort((a, b) => a.time.localeCompare(b.time));
                newSchedule[dayIndex] = { ...newSchedule[dayIndex], events: dayEvents };
                updateData({ ...data, schedule: newSchedule });
                setNewEvent({ time: "", type: "ê´€ê´‘", desc: "" });
            };

            const updateEvent = (dayIndex, eventId, field, value) => {
                const newSchedule = [...data.schedule];
                const dayEvents = [...newSchedule[dayIndex].events];
                const eventIdx = dayEvents.findIndex(e => e.id === eventId);
                if (eventIdx > -1) {
                    dayEvents[eventIdx] = { ...dayEvents[eventIdx], [field]: value };
                    if (field === 'time') dayEvents.sort((a, b) => a.time.localeCompare(b.time));
                    newSchedule[dayIndex] = { ...newSchedule[dayIndex], events: dayEvents };
                    updateData({ ...data, schedule: newSchedule });
                }
            };

            const deleteEvent = (dayIndex, eventId, e) => {
                if (e) e.stopPropagation();
                const newSchedule = data.schedule.map((day, idx) => 
                    idx === dayIndex ? { ...day, events: day.events.filter(e => e.id !== eventId) } : day
                );
                updateData({ ...data, schedule: newSchedule });
            };

            const addRecommendation = (subTab, cityId) => {
                if (!newRec.name) return;
                const newRecs = { ...data.recommendations };
                const subTabArray = [...newRecs[subTab]];
                const cityIndex = subTabArray.findIndex(c => c.id === cityId);
                if (cityIndex > -1) {
                    const newItems = [...subTabArray[cityIndex].items, { id: Date.now().toString(), name: newRec.name, desc: newRec.desc }];
                    subTabArray[cityIndex] = { ...subTabArray[cityIndex], items: newItems };
                    newRecs[subTab] = subTabArray;
                    updateData({ ...data, recommendations: newRecs });
                }
                setNewRec({ name: "", desc: "" });
            };

            const updateRecommendation = (subTab, cityId, itemId, field, value) => {
                const newRecs = { ...data.recommendations };
                const subTabArray = [...newRecs[subTab]];
                const cityIndex = subTabArray.findIndex(c => c.id === cityId);
                if (cityIndex > -1) {
                    const newItems = subTabArray[cityIndex].items.map(item => item.id === itemId ? { ...item, [field]: value } : item);
                    subTabArray[cityIndex] = { ...subTabArray[cityIndex], items: newItems };
                    newRecs[subTab] = subTabArray;
                    updateData({ ...data, recommendations: newRecs });
                }
            };

            const deleteRecommendation = (subTab, cityId, itemId, e) => {
                if (e) e.stopPropagation();
                const newRecs = { ...data.recommendations };
                const subTabArray = [...newRecs[subTab]];
                const cityIndex = subTabArray.findIndex(c => c.id === cityId);
                if (cityIndex > -1) {
                    const newItems = subTabArray[cityIndex].items.filter(i => i.id !== itemId);
                    subTabArray[cityIndex] = { ...subTabArray[cityIndex], items: newItems };
                    newRecs[subTab] = subTabArray;
                    updateData({ ...data, recommendations: newRecs });
                }
            };

            const addCookingMenu = () => {
                if (!newCooking.title) return;
                const newRecs = { ...data.recommendations };
                const newMenu = { id: Date.now().toString(), title: newCooking.title, desc: newCooking.desc, items: newCooking.ingredients.split(',').map(s => s.trim()).filter(Boolean) };
                newRecs.cooking = [...newRecs.cooking, newMenu];
                updateData({ ...data, recommendations: newRecs });
                setNewCooking({ title: "", desc: "", ingredients: "" });
            };

            const updateCookingMenu = (menuId, field, value) => {
                const newRecs = { ...data.recommendations };
                // items í•„ë“œì¸ ê²½ìš° ì‰¼í‘œë¡œ ë¶„ë¦¬í•˜ì—¬ ë°°ì—´ë¡œ ì €ì¥ (ìˆ˜ì • ì™„ë£Œ ì‹œì ì¸ onBlurì—ì„œ í˜¸ì¶œë¨)
                if (field === 'items' && typeof value === 'string') {
                    value = value.split(',').map(s => s.trim()).filter(Boolean);
                }
                newRecs.cooking = newRecs.cooking.map(m => m.id === menuId ? { ...m, [field]: value } : m);
                updateData({ ...data, recommendations: newRecs });
            };

            const deleteCookingMenu = (menuId, e) => {
                if (e) e.stopPropagation();
                const newRecs = { ...data.recommendations };
                newRecs.cooking = newRecs.cooking.filter(m => m.id !== menuId);
                updateData({ ...data, recommendations: newRecs });
            };

            // 3. êµ¬ê¸€ ë§µ ê²€ìƒ‰ ë§í¬ ì—´ê¸°
            const openGoogleSearch = (text, city) => {
                if (isEditMode) return;
                const query = `${city} ${text}`;
                window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(query)}`, '_blank');
            };

            useEffect(() => {
                if (contentRef.current) {
                    contentRef.current.scrollTop = 0;
                }
            }, [activeTab]);

            // Scroll Throttling for Performance
            useEffect(() => {
                let ticking = false;
                const handleScroll = () => {
                    if (!ticking) {
                        window.requestAnimationFrame(() => {
                            if (contentRef.current) {
                                const isThreshold = contentRef.current.scrollTop > 20;
                                setIsScrolled(prev => {
                                    if (prev !== isThreshold) return isThreshold;
                                    return prev;
                                });
                            }
                            ticking = false;
                        });
                        ticking = true;
                    }
                };
                const contentElement = contentRef.current;
                if (contentElement) contentElement.addEventListener('scroll', handleScroll);
                return () => { if (contentElement) contentElement.removeEventListener('scroll', handleScroll); };
            }, []);

            const handleEditClick = () => {
                if (isEditMode) setIsEditMode(false);
                else setShowPasswordModal(true);
            };

            const handlePasswordSubmit = () => {
                if (passwordInput === '12250723') {
                    setIsEditMode(true);
                    setShowPasswordModal(false);
                    setPasswordInput("");
                    setPasswordError(false);
                } else setPasswordError(true);
            };

            const getMapUrl = (dayEvents, currentCity) => {
                const formatLocation = (locDesc) => {
                    const cleanLoc = locDesc.split('(')[0].trim();
                    const majorCities = ["Paris", "Prague", "Praha", "Dresden", "Berlin", "Frankfurt", "Seoul", "Incheon", "Munich"];
                    const hasCity = majorCities.some(city => cleanLoc.toUpperCase().includes(city.toUpperCase()));
                    return hasCity ? cleanLoc : `${cleanLoc}, ${currentCity}`;
                };
                if (selectedLocation) return `https://maps.google.com/maps?q=${encodeURIComponent(formatLocation(selectedLocation))}&t=&z=15&ie=UTF8&iwloc=&output=embed`;
                if (dayEvents && dayEvents.length > 0) {
                    const start = formatLocation(dayEvents[0].desc);
                    const end = formatLocation(dayEvents[dayEvents.length - 1].desc);
                    let daddr = end;
                    if (dayEvents.length > 2) {
                        const waypoints = dayEvents.slice(1, dayEvents.length - 1).map(e => formatLocation(e.desc));
                        daddr = `${waypoints.join('+to:')}+to:${end}`;
                    }
                    return `https://maps.google.com/maps?saddr=${encodeURIComponent(start)}&daddr=${encodeURIComponent(daddr)}&output=embed`;
                }
                return "";
            };

            const sortedChecklistItems = [...data.checklistItems].sort((a, b) => {
                if (a.checked === b.checked) return 0;
                return a.checked ? 1 : -1;
            });

            return (
                <div className="max-w-md mx-auto h-screen flex flex-col overflow-hidden font-sans border-x border-[#000000] relative bg-[#FEF0E4]" style={{ color: '#000000' }}>
                
                {showPasswordModal && (
                    <div className="absolute inset-0 z-50 bg-[#000000] bg-opacity-50 flex items-center justify-center p-6">
                    <div className="bg-[#FEF0E4] border-2 border-[#000000] w-[90%] max-w-sm p-6 flex flex-col gap-4 shadow-[4px_4px_0px_0px_#000000]">
                        <div className="flex justify-between items-center">
                        <h3 className="font-black text-xl uppercase tracking-tighter flex items-center gap-2">
                            <LockIcon size={20} /> Password
                        </h3>
                        <button onClick={() => {setShowPasswordModal(false); setPasswordInput(""); setPasswordError(false);}} className="text-[#000000] hover:scale-110 transition-transform">
                            <XIcon size={24} />
                        </button>
                        </div>
                        <p className="text-xs font-bold leading-tight">í¸ì§‘ ëª¨ë“œëŠ” ê´€ë¦¬ìë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                        <div className="flex flex-col gap-2">
                            <input type="password" value={passwordInput} onChange={(e) => setPasswordInput(e.target.value)} onKeyPress={(e) => e.key === 'Enter' && handlePasswordSubmit()} placeholder="PASSWORD"
                            className="w-full p-3 text-base font-bold border-2 border-[#000000] bg-white focus:outline-none focus:bg-[#E0C3FC] transition-colors" autoFocus />
                            {passwordError && <p className="text-red-500 text-xs font-black">ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>}
                        </div>
                        <button onClick={handlePasswordSubmit} className="bg-[#000000] text-[#FEF0E4] w-full py-3 font-black text-sm uppercase tracking-wider hover:bg-[#E0C3FC] hover:text-[#000000] border-2 border-[#000000] transition-colors">Enter</button>
                    </div>
                    </div>
                )}

                <div ref={headerRef} className={`z-20 flex flex-col justify-end bg-[#FEF0E4] shrink-0 border-b-2 border-[#000000] transition-all duration-300 ${isScrolled ? 'py-4' : 'py-8'}`}>
                    <div className="px-6 flex justify-between items-end">
                    <div className="flex flex-col w-full">
                        <p className={`font-bold mb-1 tracking-tighter text-[#000000] uppercase transition-all duration-300 ${isScrolled ? 'text-[10px]' : 'text-sm'}`}>Europe Trip 2025</p>
                        <div className="flex justify-between items-end w-full">
                            <h1 className={`header-text font-black text-[#000000] tracking-tighter leading-[0.85] mb-2 ${isScrolled ? 'text-2xl' : 'text-6xl md:text-7xl'}`}>DOY &<br/>DONGHUI</h1>
                            <div className="text-right flex flex-col items-end gap-1 mb-1 shrink-0">
                                <button onClick={handleEditClick} className={`border-2 border-[#000000] px-4 py-1 text-xs font-bold uppercase transition-all ${isEditMode ? 'bg-[#000000] text-[#FEF0E4]' : 'bg-transparent text-[#000000] hover:bg-[#000000] hover:text-[#FEF0E4]'}`}>
                                    {isEditMode ? 'DONE' : 'EDIT'}
                                </button>
                                <p className="text-xs font-bold text-[#000000] mt-1 tracking-tighter">12.13 â€” 12.27</p>
                            </div>
                        </div>
                    </div>
                    </div>
                </div>

                <div className={`flex bg-[#FEF0E4] border-b-2 border-[#000000] shrink-0 sticky top-0 z-10`}>
                    {[{ id: 'itinerary', label: 'ITINERARY' }, { id: 'map', label: 'MAP' }, { id: 'curation', label: 'CURATION' }, { id: 'checklist', label: 'CHECKLIST' }].map(tab => (
                    <button key={tab.id} onClick={() => setActiveTab(tab.id)} className={`flex-1 py-4 text-xs sm:text-sm font-black tracking-tighter uppercase transition-colors flex flex-col items-center justify-center border-r-2 border-[#000000] last:border-r-0 ${activeTab === tab.id ? 'bg-[#E0C3FC] text-[#000000]' : 'text-[#000000] hover:bg-[#E0C3FC]'}`}>
                        {tab.label}
                    </button>
                    ))}
                </div>

                <div ref={contentRef} className="flex-1 overflow-y-auto custom-scrollbar pb-60 bg-[#FEF0E4]">
                    {activeTab === 'itinerary' && (
                    <div className="flex flex-col">
                        {data.schedule.map((dayData, dayIndex) => (
                        <div key={dayIndex} className="flex flex-col border-b-2 border-[#000000]">
                            <div className="px-6 py-4 flex justify-between items-center border-b-2 border-[#000000] bg-[#E0C3FC] text-[#000000]">
                            <div className="flex flex-col leading-none">
                                <span className="font-black text-3xl sm:text-4xl tracking-tighter">DAY {dayData.day}</span>
                                <span className="text-xs font-bold uppercase mt-1 tracking-tight">{dayData.date}</span>
                            </div>
                            <span className="text-xs font-bold border-2 border-[#000000] px-3 py-1 uppercase tracking-wide bg-[#FEF0E4]">{dayData.city}</span>
                            </div>
                            <div className="flex flex-col">
                            <div className="px-6 py-4 border-b-2 border-[#000000] bg-[#FEF0E4]">
                                <h3 className="text-xl font-black tracking-tighter uppercase">{dayData.title}</h3>
                            </div>
                            {dayData.events.map((event) => (
                                <div key={event.id} className="flex group items-stretch border-b-2 border-[#000000] last:border-b-0 min-h-[80px]">
                                <div className="w-16 flex items-center justify-center border-r-2 border-[#000000] bg-[#FEF0E4] shrink-0">
                                    {isEditMode ? (
                                        <input type="text" value={event.time} onChange={(e) => updateEvent(dayIndex, event.id, 'time', e.target.value)} className="w-full text-center text-xs font-bold bg-transparent focus:outline-none" />
                                    ) : (
                                        <span className="text-xs font-bold text-[#000000] -rotate-90 whitespace-nowrap tracking-widest">{event.time}</span>
                                    )}
                                </div>
                                <div className="flex-1 p-4 flex flex-col justify-center relative bg-[#FEF0E4] hover:bg-[#000000] hover:text-[#FEF0E4] transition-colors">
                                    <div className="flex items-center gap-2 mb-2">
                                        <div className="text-current"><MinimalIcon type={event.iconType} /></div>
                                        {isEditMode && (
                                        <select value={event.type} onChange={(e) => updateEvent(dayIndex, event.id, 'type', e.target.value)} className="text-[10px] font-bold border-2 border-[#000000] px-1 py-0.5 uppercase bg-[#FEF0E4] text-[#000000] ml-1">
                                            <option value="ê´€ê´‘">ê´€ê´‘</option><option value="ì‹ì‚¬">ì‹ì‚¬</option><option value="ì´ë™">ì´ë™</option><option value="ì‡¼í•‘">ì‡¼í•‘</option><option value="ìˆ™ì†Œ">ìˆ™ì†Œ</option><option value="ì¹´í˜">ì¹´í˜</option>
                                        </select>
                                        )}
                                        {!isEditMode && <span className="text-[10px] font-black tracking-wider uppercase opacity-70">{event.type}</span>}
                                    </div>
                                    {isEditMode ? (
                                        <input type="text" value={event.desc} onChange={(e) => updateEvent(dayIndex, event.id, 'desc', e.target.value)} className="w-full text-lg font-bold bg-transparent border-b-2 border-[#000000] focus:outline-none" />
                                    ) : (
                                        <p className="text-lg font-bold leading-tight tracking-tight">{event.desc}</p>
                                    )}
                                    {isEditMode && <button onClick={(e) => deleteEvent(dayIndex, event.id, e)} className="absolute right-4 top-4 text-red-500 hover:text-red-700"><ThinTrash /></button>}
                                </div>
                                </div>
                            ))}
                            {isEditMode && (
                                <div className="p-4 border-b-2 border-[#000000] bg-[#FEF0E4]">
                                    <div className="flex gap-2 mb-2">
                                        <input type="text" placeholder="00:00" value={newEvent.time} onChange={(e) => setNewEvent({...newEvent, time: e.target.value})} className="w-20 p-2 text-xs font-bold border-2 border-[#000000] bg-[#FEF0E4] placeholder-gray-500" />
                                        <select value={newEvent.type} onChange={(e) => setNewEvent({...newEvent, type: e.target.value})} className="p-2 text-xs font-bold border-2 border-[#000000] bg-[#FEF0E4]">
                                            <option value="ê´€ê´‘">ê´€ê´‘</option><option value="ì‹ì‚¬">ì‹ì‚¬</option><option value="ì´ë™">ì´ë™</option><option value="ì‡¼í•‘">ì‡¼í•‘</option><option value="ìˆ™ì†Œ">ìˆ™ì†Œ</option><option value="ì¹´í˜">ì¹´í˜</option>
                                        </select>
                                    </div>
                                    <div className="flex gap-2">
                                        <input type="text" placeholder="ì¼ì • ë‚´ìš©" value={newEvent.desc} onChange={(e) => setNewEvent({...newEvent, desc: e.target.value})} className="flex-1 p-2 text-base font-bold border-2 border-[#000000] bg-[#FEF0E4] placeholder-gray-500" />
                                        <button onClick={() => addEvent(dayIndex)} className="px-4 py-2 bg-[#000000] text-[#FEF0E4] text-xs font-black uppercase">ì¶”ê°€</button>
                                    </div>
                                </div>
                            )}
                            </div>
                        </div>
                        ))}
                    </div>
                    )}

                    {activeTab === 'map' && (
                    <div className="flex flex-col border-b-2 border-[#000000]">
                        <div className="p-6 border-b-2 border-[#000000] flex flex-col gap-4 bg-[#FEF0E4]">
                            <div className="flex justify-between items-center">
                                <div className="flex gap-2">
                                    <button onClick={() => setMapViewMode('real')} className={`px-4 py-2 text-xs font-black border-2 border-[#000000] uppercase transition-all tracking-tighter ${mapViewMode === 'real' ? 'bg-[#000000] text-[#FEF0E4]' : 'bg-transparent text-[#000000] hover:bg-[#000000] hover:text-[#FEF0E4]'}`}>Google Map</button>
                                    <button onClick={() => setMapViewMode('schematic')} className={`px-4 py-2 text-xs font-black border-2 border-[#000000] uppercase transition-all tracking-tighter ${mapViewMode === 'schematic' ? 'bg-[#000000] text-[#FEF0E4]' : 'bg-transparent text-[#000000] hover:bg-[#000000] hover:text-[#FEF0E4]'}`}>Route</button>
                                </div>
                            </div>
                            <div className="flex items-center gap-2 overflow-x-auto max-w-full no-scrollbar pb-2">
                                {data.schedule.map((day) => (
                                    <button key={day.day} onClick={() => { setSelectedDay(day.day); setSelectedLocation(null); }} className={`shrink-0 w-8 h-8 flex items-center justify-center text-xs font-black border-2 border-[#000000] transition-all ${selectedDay === day.day ? 'bg-[#000000] text-[#FEF0E4]' : 'bg-transparent text-[#000000] hover:bg-[#000000] hover:text-[#FEF0E4]'}`}>{day.day}</button>
                                ))}
                            </div>
                            {isEditMode && (
                                <div className="flex gap-2 items-center bg-[#FEF0E4] p-2 border-2 border-[#000000]">
                                    <input type="text" placeholder="00:00" value={newEvent.time} onChange={(e) => setNewEvent({...newEvent, time: e.target.value})} className="w-16 p-1 text-xs font-bold border-2 border-[#000000] bg-[#FEF0E4]" />
                                    <input type="text" placeholder="ì¥ì†Œ ì´ë¦„" value={newEvent.desc} onChange={(e) => setNewEvent({...newEvent, desc: e.target.value})} className="flex-1 p-1 text-base font-bold border-2 border-[#000000] bg-[#FEF0E4]" />
                                    <button onClick={() => addEvent(selectedDay - 1)} className="bg-[#000000] text-[#FEF0E4] px-3 py-1 text-xs font-bold">ì¶”ê°€</button>
                                </div>
                            )}
                        </div>
                        {mapViewMode === 'schematic' && (
                        <div className="p-8 bg-[#FEF0E4]">
                            <div className="mb-8 border-b-4 border-[#000000] pb-4">
                                <h2 className="text-5xl sm:text-6xl font-black text-[#000000] mb-2 uppercase tracking-tighter leading-none">{data.schedule[selectedDay-1].city}</h2>
                                <p className="text-lg font-bold text-[#000000]">{data.schedule[selectedDay-1].date}</p>
                            </div>
                            <div className="relative pl-6 space-y-0 border-l-4 border-[#000000] ml-2">
                                {data.schedule[selectedDay-1].events.map((event, idx) => (
                                    <div key={idx} className="relative pl-8 pb-12 last:pb-0 group">
                                        <div className="absolute -left-[10px] top-2 w-4 h-4 bg-[#FEF0E4] border-4 border-[#000000]"></div>
                                        <span className="font-mono text-xs font-bold text-[#000000] block mb-1 opacity-100">{event.time}</span>
                                        <span className="text-xl sm:text-2xl font-black text-[#000000] block uppercase tracking-tighter leading-none">{event.desc.split('(')[0]}</span>
                                        {isEditMode && <button onClick={(e) => deleteEvent(selectedDay-1, event.id, e)} className="text-red-500 absolute right-0 top-0 opacity-0 group-hover:opacity-100 transition-opacity"><ThinTrash /></button>}
                                    </div>
                                ))}
                            </div>
                        </div>
                        )}
                        {mapViewMode === 'real' && (
                        <div className="flex flex-col">
                            <div className="h-[400px] bg-gray-200 relative border-b-2 border-[#000000]">
                                <iframe title="Google Map" width="100%" height="100%" frameBorder="0" scrolling="no" src={getMapUrl(data.schedule[selectedDay-1].events, data.schedule[selectedDay-1].city)} className="opacity-100"></iframe>
                            </div>
                            <div className="bg-[#FEF0E4] p-0">
                                <div className="sticky top-0 bg-[#E0C3FC] border-b-2 border-[#000000] p-4">
                                <p className="text-xs font-black text-[#000000] uppercase tracking-widest flex items-center gap-2"><MapPinIcon size={16} /> Day {selectedDay} Locations</p>
                                </div>
                                <div className="divide-y-2 divide-[#000000]">
                                {data.schedule[selectedDay-1].events.map((event, idx) => (
                                    <div key={idx} className="flex justify-between items-center w-full px-6 py-4 group hover:bg-[#000000] hover:text-[#FEF0E4] transition-colors cursor-pointer">
                                        <button onClick={() => setSelectedLocation(event.desc.split('(')[0])} className="text-left text-base flex-1"><span className="truncate font-bold tracking-tight">{event.desc}</span></button>
                                        {isEditMode && <button onClick={(e) => deleteEvent(selectedDay-1, event.id, e)} className="text-red-500 hover:text-red-300 ml-2"><ThinTrash /></button>}
                                    </div>
                                ))}
                                </div>
                            </div>
                        </div>
                        )}
                    </div>
                    )}

                    {activeTab === 'curation' && (
                    <div className="flex flex-col">
                        <div className="flex border-b-2 border-[#000000] sticky top-0 z-10 bg-[#FEF0E4]">
                        {[{ id: 'places', label: 'PLACES' }, { id: 'shopping', label: 'SHOPPING' }, { id: 'cooking', label: 'COOKING' }].map(sub => (
                            <button key={sub.id} onClick={() => setRecommendSubTab(sub.id)} className={`flex-1 py-3 text-xs font-black tracking-tight transition-all border-r-2 border-[#000000] last:border-r-0 ${recommendSubTab === sub.id ? 'bg-[#000000] text-[#FEF0E4]' : 'bg-[#FEF0E4] text-[#000000] hover:bg-[#000000] hover:text-[#FEF0E4]'}`}>{sub.label}</button>
                        ))}
                        </div>
                        {(recommendSubTab === 'places' || recommendSubTab === 'shopping') && (
                            <div className="flex flex-col">
                                {data.recommendations[recommendSubTab].map((dataGroup, idx) => (
                                    <div key={dataGroup.id} className="bg-[#FEF0E4] flex flex-col">
                                        <div className="px-6 py-4 border-b-2 border-[#000000] flex items-center justify-between bg-[#E0C3FC] text-[#000000]">
                                            <h3 className="font-black text-2xl uppercase tracking-tighter">{dataGroup.city}</h3>
                                        </div>
                                        <div className="flex flex-col">
                                            {dataGroup.items.map((item, i) => (
                                                <div key={item.id} onClick={() => openGoogleSearch(item.name, dataGroup.city)} className="px-6 py-5 border-b-2 border-[#000000] hover:bg-[#000000] hover:text-[#FEF0E4] transition-colors group cursor-pointer relative">
                                                    <div className="flex justify-between items-baseline mb-1">
                                                        {isEditMode ? (
                                                            <input onClick={(e) => e.stopPropagation()} value={item.name} onChange={(e) => updateRecommendation(recommendSubTab, dataGroup.id, item.id, 'name', e.target.value)} className="font-black text-lg uppercase bg-transparent border-b-2 border-[#000000] focus:outline-none w-full mr-2" />
                                                        ) : (
                                                            <span className="font-black text-lg sm:text-xl uppercase tracking-tight leading-none">{item.name}</span>
                                                        )}
                                                    </div>
                                                    {isEditMode ? (
                                                        <input onClick={(e) => e.stopPropagation()} value={item.desc} onChange={(e) => updateRecommendation(recommendSubTab, dataGroup.id, item.id, 'desc', e.target.value)} className="text-sm font-bold w-full bg-transparent border-b-2 border-[#000000] focus:outline-none" />
                                                    ) : (
                                                        <span className="text-sm font-bold opacity-80 group-hover:opacity-100 block">{item.desc}</span>
                                                    )}
                                                    {isEditMode && <button onClick={(e) => deleteRecommendation(recommendSubTab, dataGroup.id, item.id, e)} className="absolute right-4 top-4 text-red-500"><ThinTrash /></button>}
                                                </div>
                                            ))}
                                            {isEditMode && (
                                                <div className="p-4 border-b-2 border-[#000000] bg-[#FEF0E4] flex flex-col gap-2">
                                                        <input placeholder="ì´ë¦„" value={newRec.name} onChange={(e) => setNewRec({...newRec, name: e.target.value})} className="p-2 text-xs font-bold border-2 border-[#000000] bg-[#FEF0E4]" />
                                                        <div className="flex gap-2">
                                                            <input placeholder="ì„¤ëª…" value={newRec.desc} onChange={(e) => setNewRec({...newRec, desc: e.target.value})} className="flex-1 p-2 text-xs font-bold border-2 border-[#000000] bg-[#FEF0E4]" />
                                                            <button onClick={() => addRecommendation(recommendSubTab, dataGroup.id)} className="bg-[#000000] text-[#FEF0E4] px-3 py-1 text-xs font-black uppercase">ì¶”ê°€</button>
                                                        </div>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}
                        {recommendSubTab === 'cooking' && (
                        <div className="flex flex-col bg-[#FEF0E4]">
                            {/* [ìˆ˜ì •] 1. í° ê³µë°± ì œê±°, ì•„ì´ì½˜ ìœ„ì¹˜ ì¡°ì • */}
                            <div className="border-b-2 border-[#000000] p-6 pt-10 relative bg-[#E0C3FC] z-0">
                                <div className="absolute top-3 left-6 px-2 border-2 border-[#000000] bg-[#E0C3FC] z-10"><MinimalChefHat /></div>
                                <h3 className="font-black text-xl uppercase mb-1 tracking-tighter">Parisian Dining</h3>
                                <p className="text-sm font-bold leading-tight opacity-100">íŒŒë¦¬ í˜„ì§€ ë§ˆíŠ¸(Monoprix, Franprix)ë‚˜ ì‹œì¥ì—ì„œ ì‹ ì„ í•œ ì¬ë£Œë¥¼ ì‚¬ì„œ ì—ì–´ë¹„ì•¤ë¹„ì—ì„œ ìš”ë¦¬í•´ ë³´ì„¸ìš”.</p>
                            </div>
                            {data.recommendations.cooking.map((menu, idx) => (
                            <div key={menu.id} className="border-b-2 border-[#000000] p-6 relative group hover:bg-[#000000] hover:text-[#FEF0E4] transition-colors">
                                {isEditMode ? (
                                    <input value={menu.title} onChange={(e) => updateCookingMenu(menu.id, 'title', e.target.value)} className="font-black text-xl sm:text-2xl mb-2 uppercase bg-transparent border-b-2 border-[#000000] w-full" />
                                ) : (
                                    <h4 className="font-black text-xl sm:text-2xl mb-2 uppercase tracking-tighter">{menu.title}</h4>
                                )}
                                {isEditMode ? (
                                    <input value={menu.desc} onChange={(e) => updateCookingMenu(menu.id, 'desc', e.target.value)} className="text-sm mb-4 font-bold w-full bg-transparent border-b-2 border-[#000000]" />
                                ) : (
                                    <p className="text-sm mb-4 font-bold opacity-80 leading-relaxed">{menu.desc}</p>
                                )}
                                <div className="flex flex-wrap gap-2">
                                    {isEditMode ? (
                                        // [ìˆ˜ì •] 2. ì¬ë£Œ ìˆ˜ì • ììœ ë¡­ê²Œ (onBlurì‹œ ì €ì¥)
                                        <input
                                            value={tempCookingItems[menu.id] !== undefined ? tempCookingItems[menu.id] : menu.items.join(', ')}
                                            onChange={(e) => setTempCookingItems({...tempCookingItems, [menu.id]: e.target.value})}
                                            onBlur={() => {
                                                updateCookingMenu(menu.id, 'items', tempCookingItems[menu.id]);
                                                setTempCookingItems(prev => { const n = {...prev}; delete n[menu.id]; return n; });
                                            }}
                                            className="w-full text-xs border-2 border-[#000000] p-2 font-bold bg-transparent focus:bg-[#E0C3FC]"
                                            placeholder="ì¬ë£Œë¥¼ ì‰¼í‘œë¡œ êµ¬ë¶„í•˜ì—¬ ì…ë ¥ (ì˜ˆ: ì†Œê³ ê¸°, ë²„í„°)"
                                        />
                                    ) : (
                                        menu.items.map((ing, i) => (
                                            <span key={i} className="text-xs border-2 border-current px-2 py-1 uppercase tracking-wide font-bold">{ing}</span>
                                        ))
                                    )}
                                </div>
                                {isEditMode && <button onClick={(e) => deleteCookingMenu(menu.id, e)} className="absolute right-4 top-6 text-red-500"><ThinTrash /></button>}
                            </div>
                            ))}
                            {isEditMode && (
                                <div className="border-b-2 border-[#000000] p-6 bg-[#FEF0E4]">
                                    <h4 className="text-sm font-black mb-2 uppercase">ìƒˆ ë©”ë‰´ ì¶”ê°€</h4>
                                    <input placeholder="ë©”ë‰´ ì´ë¦„" value={newCooking.title} onChange={(e) => setNewCooking({...newCooking, title: e.target.value})} className="w-full p-2 text-xs font-bold border-2 border-[#000000] bg-[#FEF0E4] mb-2" />
                                    <input placeholder="ì„¤ëª…" value={newCooking.desc} onChange={(e) => setNewCooking({...newCooking, desc: e.target.value})} className="w-full p-2 text-xs font-bold border-2 border-[#000000] bg-[#FEF0E4] mb-2" />
                                    <input placeholder="ì¬ë£Œ (ì‰¼í‘œë¡œ êµ¬ë¶„)" value={newCooking.ingredients} onChange={(e) => setNewCooking({...newCooking, ingredients: e.target.value})} className="w-full p-2 text-xs font-bold border-2 border-[#000000] bg-[#FEF0E4] mb-2" />
                                    <button onClick={addCookingMenu} className="bg-[#000000] text-[#FEF0E4] px-3 py-2 text-xs w-full font-black uppercase">ë©”ë‰´ ì¶”ê°€</button>
                                </div>
                            )}
                        </div>
                        )}
                    </div>
                    )}

                    {activeTab === 'checklist' && (
                    <div className="flex flex-col bg-[#FEF0E4]">
                        <div className="border-b-2 border-[#000000] p-6 bg-[#E0C3FC] text-[#000000] shrink-0">
                            <h3 className="font-black text-lg mb-3 flex items-center gap-2 uppercase tracking-wide"><AlertTriangleIcon size={20} /> Notice</h3>
                            <ul className="text-sm space-y-2 list-disc list-inside font-bold leading-relaxed">
                                {data.notices.map(notice => (
                                    <li key={notice.id} className="flex items-center justify-between group">
                                        {isEditMode && editingNoticeId === notice.id ? (
                                            <input value={tempNoticeText} onChange={(e) => setTempNoticeText(e.target.value)} onBlur={() => saveEditingNotice(notice.id)} onKeyPress={(e) => e.key === 'Enter' && saveEditingNotice(notice.id)} className="flex-1 bg-transparent border-b-2 border-[#000000] text-[#000000] text-sm font-bold focus:outline-none" autoFocus />
                                        ) : (
                                            <span onClick={() => startEditingNotice(notice.id, notice.text)} className={isEditMode ? "cursor-pointer hover:underline" : ""}>{notice.text}</span>
                                        )}
                                        {isEditMode && <button onClick={() => deleteNotice(notice.id)} className="text-red-500 hover:text-red-700 ml-2"><ThinTrash size={14} /></button>}
                                    </li>
                                ))}
                            </ul>
                            {isEditMode && (
                                <div className="mt-4 flex gap-2">
                                    <input value={newNoticeText} onChange={(e) => setNewNoticeText(e.target.value)} placeholder="ìƒˆ ê³µì§€ì‚¬í•­" className="flex-1 p-2 text-xs font-bold bg-[#FEF0E4] border-2 border-[#000000] text-[#000000] placeholder-gray-500" />
                                    <button onClick={addNotice} className="text-xs border-2 border-[#000000] px-3 bg-[#FEF0E4] hover:bg-[#000000] hover:text-[#FEF0E4] transition-colors"><PlusIcon size={16} /></button>
                                </div>
                            )}
                        </div>
                        <div className="p-4 border-b-2 border-[#000000] flex gap-2 shrink-0 bg-[#FEF0E4]">
                            <input type="text" value={newItemText} onChange={(e) => setNewItemText(e.target.value)} onKeyPress={(e) => e.key === 'Enter' && addChecklistItem()} placeholder="ADD NEW ITEM..." className="flex-1 bg-[#FEF0E4] border-2 border-[#000000] px-4 py-3 text-base font-bold placeholder-gray-500 outline-none focus:bg-[#E0C3FC] transition-colors uppercase" />
                            <button onClick={addChecklistItem} className="bg-[#000000] text-[#FEF0E4] px-4 py-3 border-2 border-[#000000] hover:bg-[#E0C3FC] hover:text-[#000000] transition-colors"><PlusIcon size={20} /></button>
                        </div>
                        <div className="flex flex-col bg-[#FEF0E4]">
                        {sortedChecklistItems.map((item) => (
                            <div key={item.id} onClick={() => toggleCheck(item.id)} className={`px-6 py-5 flex items-center gap-4 cursor-pointer transition-all border-b-2 border-[#000000] hover:bg-[#000000] hover:text-[#FEF0E4] group ${item.checked ? 'bg-[#FEF0E4] opacity-50' : ''}`}>
                            <div className={`w-6 h-6 border-2 flex items-center justify-center shrink-0 transition-colors ${item.checked ? 'bg-[#000000] border-[#000000] group-hover:bg-[#FEF0E4] group-hover:border-[#FEF0E4]' : 'border-[#000000] group-hover:border-[#FEF0E4]'}`}>
                                {item.checked && <CheckSquareIcon size={16} />}
                            </div>
                            <div className="flex-1 flex justify-between items-center">
                                {editingChecklistId === item.id && isEditMode ? (
                                <input type="text" value={tempChecklistText} onChange={(e) => setTempChecklistText(e.target.value)} onBlur={() => saveEditingChecklist(item.id)} onKeyPress={(e) => e.key === 'Enter' && saveEditingChecklist(item.id)} className="flex-1 bg-transparent border-b-2 border-[#000000] text-lg font-black focus:outline-none" autoFocus onClick={(e) => e.stopPropagation()} />
                                ) : (
                                <div onClick={(e) => { if (isEditMode) { e.stopPropagation(); startEditingChecklist(item.id, item.text); } }} className={`text-lg font-black flex-1 uppercase tracking-tight ${item.checked ? 'line-through decoration-2 decoration-[#000000] group-hover:decoration-[#FEF0E4]' : ''}`}>{item.text}</div>
                                )}
                                {!item.checked && item.important && <span className="text-[10px] border-2 border-red-500 text-red-500 px-2 py-0.5 font-bold uppercase group-hover:border-[#FEF0E4] group-hover:text-[#FEF0E4] ml-2">Important</span>}
                                {(parseInt(item.id) > 1000 || isEditMode) && <button onClick={(e) => deleteChecklistItem(e, item.id)} className="text-gray-400 hover:text-red-500 group-hover:text-[#FEF0E4] group-hover:hover:text-red-300 ml-4"><ThinTrash size={18} /></button>}
                            </div>
                            </div>
                        ))}
                        </div>
                    </div>
                    )}
                </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
